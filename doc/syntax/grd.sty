%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{color}%

% \usepackage[T1]{fontenc}%
\usepackage{amsmath}%
\usepackage{amssymb}%
\usepackage{bm}%
\usepackage{stmaryrd}%
\usepackage[color,zed]{csp}%
% \usepackage[inference]{semantic}%
%\usepackage[top=2.5cm,bottom=2.5cm,left=2.5cm,right=2.5cm]{geometry}%
\usepackage[utf8]{inputenc}%
% \usepackage[zed,color]{csp}%
\usepackage{colornames}%
\usepackage{courier}%
\usepackage{crayola}%
\usepackage{fancyvrb}%
\usepackage{float}%
\usepackage[T1]{fontenc}%
\usepackage{graphicx}%
\usepackage{harpoon}%
\usepackage{hyperref}%
\usepackage{listings}%
\usepackage{lstcustom}%
\usepackage{paralist}%
\usepackage{pdflscape}%
\usepackage{relsize}%
\usepackage{stackrel}%
\usepackage{stmaryrd}%
\usepackage{thmtools,thm-restate}%
\usepackage{url}%
\usepackage[scaled]{helvet}% (added at suggestion of reviewer)
\usepackage{ifthen}%
\usepackage{bussproofs}
\usepackage{xspace}

\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}

\newtheorem{axiom}{Axiom}[section]%
\newtheorem{counterexample}{Counterexample}[section]%
%\newtheorem{example}{Example}[section]%
\newtheorem{law}{Law}[section]%
%\newtheorem{lemma}{Lemma}[section]%
%\newtheorem{proof}{Proof}[section]%
\newtheorem{opsemrule}{Rule}[section]%
%\newtheorem{theorem}{Theorem}[section]%

% \newenvironment{proof}{\mbox{}\newline\medskip\textbf{Proof~~}}{$\Box$}

\newenvironment{mydrop}{\begin{array}[t]{@{}l@{}}}{\end{array}}%

\renewcommand{\timeout}[1]{\mathop{~\stackrel{#1}{\rres}~}}%

% \newcounter{case}%

\newcommand{\Aminimal}{\mathrel{\mathsf{A\!\!-\!\!minimal\; for}}}%
\newcommand{\Bool}{\mathbb{B}}%
\newcommand{\CircusTime}{\textsf{\slshape CircusTime}\xspace}%
\newcommand{\Circus}{\textsf{\slshape Circus}\xspace}%
\newcommand{\CML}{\textsf{\slshape CML}\xspace}%
\newcommand{\Definedin}[2]{\mathcal{D}_{#1}#2}%
\newcommand{\Definedsub}[2]{\mathcal{D}_{#1}#2}%
\newcommand{\Defined}[1]{\mathcal{D}#1}%
\newcommand{\Guards}{\mathrel{\leadsto}}%
\newcommand{\Guard}[1]{\mathcal{G}#1}%
\newcommand{\HoarePreorder}{\SemanticPreorder{H}}%
\newcommand{\IID}{\II_{\hbox{\tiny\ckey{D}}}}%
\newcommand{\IIRT}{\II_{\hbox{\tiny\ckey{RT}}}}%
\newcommand{\II}{{\hbox{\texttt{\slshape I \kern -10.5pt I}}}}%
\newcommand{\IIrea}{\II_\rea}%
\newcommand{\IIrd}{\II_\rdes}%
\newcommand{\IIsrd}{\II_\srdes}%
\newcommand{\Lamporttriple}[3]{\color{black} \left\{\color{ZedColor}#1 \color{black} \right\} \color{ZedColor}~ #2 ~\lhoare~ #3 ~\rhoare} %
\newcommand{\Law}[3]{\begin{array}{@{}p{4ex}@{~~}l} \textbf{\textit{#1}} & #2 \end{array} & \textsf{\textit{{#3}}}} %
\newcommand{\NamelessLaw}[2]{\begin{array}{@{}p{4ex}@{~~}l} \textbf{\textit{#1}} & #2 \end{array}} %
\newcommand{\OhCircus}{\textsf{\slshape OhCircus}}%
\newcommand{\SemanticPreorder}[1]{\mathrel{\sqsubseteq_#1\mkern-4mu}}%
\newcommand{\SmythPreorder}{\SemanticPreorder{S}}%
\newcommand{\TGuards}{\mathrel{\dot{\leadsto}}}%
\newcommand{\Undefined}[1]{\lnot \Defined{#1}}%
\newcommand{\Univ}{\mathbb{U}}%
\newcommand{\usefact}{}%
\newcommand{\abortoo}{\bot_{OO}}%
\newcommand{\aext}{\mathop{\oplus_p}}%
\newcommand{\argline}[1]{~~~~~~ #1 }%
\newcommand{\ares}{\mathop{\upharpoonright_p}}%
\newcommand{\assumption}[1]{{\sffamily\upshape\newcounter{#1} assumption (\nextcase) \setcounter{#1}{\thecase}}}%
\newcommand{\assigns}[1]{\langle #1 \rangle}
\newcommand{\assignsD}[1]{\langle #1 \rangle_{\tiny \healthy{D}}}
\newcommand{\assignsR}[1]{\langle #1 \rangle_{\tiny \healthy{R}}}
\newcommand{\assigniC}[2]{#1 \,\mathop{:=_{\theory{\tiny C}}}\, #2}
\newcommand{\atinst}{\mathop{\textnormal{@}}}%
\newcommand{\atomic}[1]{\latomic~ #1 ~\ratomic}%
%\newcommand{\axiom}{\mathrel{\vdash}}%
\newcommand{\beginsy}{|\kern-4pt[}%
\newcommand{\bftt}[1]{\hbox{\texttt{\bfseries #1}}}%
\newcommand{\bindings}{{\cal B}}%
\newcommand{\blackhole}[1]{}%
\newcommand{\botD}{\bot_D}%
\newcommand{\bottvlbasic}{{\bot}}%
\newcommand{\bottvllite}{{\color{red}\bot_{T}}}%
\newcommand{\boxit}[2]{\hbox{\color{#1}\fbox{\color{ZedColor}$#2$}}}%
\newcommand{\Chaos}{\ckey{Chaos}}
\newcommand{\ckey}[1]{\hbox{\textbf{\textsf{\textsl{#1}}}}}%
\newcommand{\cmlII}{\cmlmathord{II}}%
\newcommand{\cmlSKIP}{\cmlkword{SKIP}}%
\newcommand{\cmlSTOP}{\cmlkword{STOP}}%
\newcommand{\cmlabort}{\cmlvariable{abort}}%
\newcommand{\cmlamp}{\cmlmathrel{&}}%
\newcommand{\cmland}{\cmlmathrel{and}}%
\newcommand{\cmlassign}{\cmlmathrel{:=}}%
\newcommand{\cmlat}{\cmlmathrel{@}}%
\newcommand{\cmlatt}{\cmlmathrel{att}}%
\newcommand{\cmlbang}{\cmlmathord{!}}%
\newcommand{\cmlbegin}{\cmlmathrel{begin}}%
\newcommand{\cmlbot}{\cmlmathord{bot}}%
\newcommand{\cmlbox}{\cmlmathrel{[]}}%
\newcommand{\cmlcases}{\cmlmathrel{cases}}%
\newcommand{\cmlchoas}{\cmlvariable{Chaos}}%
\newcommand{\cmlclass}{\cmlmathrel{class}}%
\newcommand{\cmlcolon}{\cmlmathpunct{:}}%
\newcommand{\cmlcomma}{\cmlmathpunct{,}}%
\newcommand{\cmldiv}{\cmlvariable{Div}}%
\newcommand{\cmldot}{\cmlmathord{.}}%
\newcommand{\cmldo}{\cmlmathrel{do}}%
\newcommand{\cmlelseif}{\cmlmathrel{elseif}}%
\newcommand{\cmlelse}{\cmlmathrel{else}}%
\newcommand{\cmlend}{\cmlmathord{end}}%
\newcommand{\cmlendby}{\cmlmathrel{endby}}%
\newcommand{\cmlequals}{\cmlmathrel{=}}%
\newcommand{\cmlequiv}{\cmlmathrel{<=>}}%
\newcommand{\cmleventdot}{\hbox{\lstinline{.}}}%
%\newcommand{\cmleventdot}{\cmlmathord{.}\mkern-1mu}%
\newcommand{\cmlexists}{\bf{\cmlmathrel{exists}}}%
\newcommand{\cmlextchoice}{\cmlmathrel{[]}}%
\newcommand{\cmlextends}{\cmlmathrel{extends}}%
\newcommand{\cmlextrachoice}{\cmlmathrel{[+]}}%
\newcommand{\cmlextralpar}{\cmlmathrel{[+|}}%
\newcommand{\cmlextrarpar}{\cmlmathrel{|+]}}%
\newcommand{\cmlfalse}{\cmlvariable{false}}%
\newcommand{\cmlforall}{\bf\cmlmathrel{forall}}%  %
\newcommand{\cmlfor}{\cmlmathrel{for}}%
\newcommand{\cmlgt}{\cmlmathrel{>}}%
\newcommand{\cmlhide}{\cmlmathrel{\\}}%
\newcommand{\cmlif}{\cmlmathrel{if}}%
\newcommand{\cmlis}{\cmlmathrel{is}}%
\newcommand{\cmlimplies}{\cmlmathrel{=>}}%
\newcommand{\cmlinfixelse}{\cmlmathrel{|>}}%
\newcommand{\cmlinfixif}{\cmlmathrel{<|}}%
\newcommand{\cmlintchoice}{\cmlmathrel{|~|}}%
\newcommand{\cmlinter}{\cmlmathrel{inter}}%
\newcommand{\cmlin}{\cmlmathrel{in}}%
\newcommand{\cmlkword}[1]{\hbox{\lstinline{#1}}}%
\newcommand{\cmllambda}{\cmlmathop{lambda}}%
\newcommand{\cmllbrace}{\cmlmathord{\{}}%
\newcommand{\cmllbrack}{\cmlmathord{[}}%
\newcommand{\cmllchanset}{\cmlmathrel{\{|}}%
\newcommand{\cmllinter}{\cmlmathrel{[||}}%
\newcommand{\cmllet}{\cmlmathop{let}~~}%
\newcommand{\cmlloc}{\cmlmathop{loc}~~}%
\newcommand{\cmllparallel}{\cmlmathrel{||}}%
\newcommand{\cmllparen}{\cmlmathord{(}}%
\newcommand{\cmllpar}{\cmlmathrel{[|}}%
\newcommand{\cmllt}{\cmlmathrel{<}}%
\newcommand{\cmlmathclose}[1]{\mathrel{\hbox{\lstinline{#1}}}}%
\newcommand{\cmlmathopen}[1]{\mathrel{\hbox{\lstinline{#1}}}}%
\newcommand{\cmlmathop}[1]{\mathop{\hbox{\lstinline{#1}}}}%
\newcommand{\cmlmathord}[1]{\mathord{\hbox{\lstinline{#1}}}}%
\newcommand{\cmlmathpunct}[1]{\mathpunct{\hbox{\lstinline{#1}}}}%
\newcommand{\cmlmathrel}[1]{\mathrel{\hbox{\lstinline{#1}}}}%
\newcommand{\cmlmerge}{\cmlmathrel{||}}%
\newcommand{\cmlmeth}{\cmlmathrel{meth}}%
\newcommand{\cmlmid}{\cmlmathrel{|}}%
\newcommand{\cmlmu}{\cmlmathop{mu}}%
\newcommand{\cmlnot}{\cmlmathop{not}}%
\newcommand{\cmlnull}{\cmlmathord{null}}%
\newcommand{\cmlor}{\cmlmathop{or}}%
\newcommand{\cmloperations}{\cmlmathrel{operations}}%
\newcommand{\cmlothers}{\cmlmathrel{others}}%
\newcommand{\cmlparallel}{\cmlmathop{||}}%
\newcommand{\cmlpost}{\cmlmathop{post}}%
\newcommand{\cmlplus}{\cmlmathrel{+}}%
\newcommand{\cmlprefix}{\cmlmathrel{->}}%
\newcommand{\cmlpre}{\cmlmathop{pre}}%
\newcommand{\cmlquery}{\cmlmathpunct{?}}%
\newcommand{\cmlrbrace}{\cmlmathord{\}}}%
\newcommand{\cmlrbrack}{\cmlmathord{]}}%
\newcommand{\cmlrchanset}{\cmlmathrel{|\}}}%
\newcommand{\cmlrestrict}{\filter}%
\newcommand{\cmlres}{\cmlmathord{res}~~}%
\newcommand{\cmlret}{\cmlkword{ret}}%
\newcommand{\cmlrinter}{\cmlmathrel{||]}}%
\newcommand{\cmlrparen}{\cmlmathord{)}}%
\newcommand{\cmlrpar}{\cmlmathrel{|]}}%
\newcommand{\cmlself}{\cmlmathord{self}}%
\newcommand{\cmlsemi}{\cmlmathrel{;}}%
\newcommand{\cmlskip}{\cmlvariable{Skip}}%
\newcommand{\cmlslash}{\cmlmathrel{/}}%
\newcommand{\cmlslide}{\cmlmathrel{[>}}%
\newcommand{\cmlstartby}{\cmlmathrel{startby}}%
\newcommand{\cmlstate}{\cmlmathrel{state}}%
\newcommand{\cmlstop}{\cmlvariable{Stop}}%
\newcommand{\cmlsuper}{\cmlmathrel{super}}%
\newcommand{\cmlthen}{\cmlmathrel{then}}%
%\newcommand{\cmltimedinterrupt}[1]{\mathrel{\cmlmathord{/}\cmlvariable{#1}\cmlmathord{\backslash}}}%
\newcommand{\cmltimedinterrupt}[1]{\mathrel{\cmlmathord{/}\cmlvariable{#1}\backslash}}%
\newcommand{\cmltimeout}[1]{\mathrel{\cmlmathord{[}\cmlvariable{#1}\cmlmathord{]}}}%
\newcommand{\cmltrue}{\cmlvariable{true}}%
\newcommand{\cmlvariable}[1]{\hbox{\lstinline{#1}}}%
\newcommand{\cmlval}{\cmlmathord{val}~~}%
\newcommand{\cmlvar}{\cmlmathord{var}~~}%
\newcommand{\cmlvres}{\cmlmathord{vres}~~}%
\newcommand{\cmlwait}{\cmlmathrel{wait}}%
\newcommand{\cmlwhile}{\cmlmathop{while}}%
\newcommand{\configx}{\cmlmathrel{\models}}%
\newcommand{\conalpha}{\mathrm{con}\alpha}%
\newcommand{\conditional}[3]{#1 \infixIf #2 \infixElse #3}%
\newcommand{\conditionalv}[3]{%
  \begin{array}{l}%
    #1 \\ %
    \qquad \infixIf #2 \infixElse \\ %
    \qquad \qquad #3 %
  \end{array}%
}%
\newcommand{\constrain}{\mid}%
\newcommand{\conton}{\mathop{\,\textsf{cont-on}\,}}%
\newcommand{\defined}{{\cal D}}%
\newcommand{\definite}[1]{\ckey{definite}(#1)}%
\newcommand{\design}[2]{#1 \shows #2}%
\newcommand{\dintv}[1]{\left\lceil\kern-3pt\left\lceil #1 \right\rceil\kern-3pt\right\rceil}
\newcommand{\disalpha}{\mathrm{dis}\alpha}%
\newcommand{\dropWhile}{\mathrm{dropWhile}}
\newcommand{\dur}{\ell}%
\newcommand{\healthydesign}[3]{#2 \shows_{\littleckey{#1}} #3}%
\newcommand{\scopeend}{\mathop{\ckey{end}}}%
\newcommand{\equalstvlbasic}{\mathrel{=_T}}%
\newcommand{\equalstvllite}{{\color{red}\equalstvlbasic}}%
\newcommand{\equalstvl}{\mathrel{\color{red}=_T}}%
\newcommand{\falsetvlbasic}{false}%
\newcommand{\falsetvllite}{{\color{red}\falsetvlbasic_{T}}}%
\newcommand{\foralltvlkern}{{\color{red}\forall\!}}%
\newcommand{\foralltvl}{{\color{red}\forall_{T}}}%
\newcommand{\healthy}[1]{\ckey{#1}}%
\newcommand{\hint}[1]{%
  {\color{red}%
    \left\{~%
      \begin{array}{@{}l@{}}%
        \hbox{\textsf{#1}}%
      \end{array}%
      ~\right\}%
  }%
}%
\newcommand{\hoaretriple}[3]{#1 ~\lhoare~ #2 ~\rhoare~ #3}%
\renewcommand{\impliedby}{\Leftarrow}
\newcommand{\impliestvl}{\mathrel{\color{red}\Rightarrow_{T}}}%
\newcommand{\inccase}{\addtocounter{case}{1}}%
\newcommand{\infixElse}{\mathop{\hbox{\raisebox{0ex}{\larger$\rightslice$}}}}%
\newcommand{\infixIf}{\mathop{\hbox{\raisebox{0ex}{\larger$\leftslice$}}}}%
\newcommand{\initcase}{\setcounter{case}{0}}%
\newcommand{\internew}[1]{\mathop{\cap_{#1}}}%
\newcommand{\intvLeft}{\lceil}%
\newcommand{\intvRight}{\rceil}%
\newcommand{\intv}[1]{\left\intvLeft #1 \right\intvRight}%
\newcommand{\iotatvlkern}{{\color{red}\iota\!}}%
\newcommand{\iotatvl}{{\color{red}\iota_{T}}}%
\newcommand{\lamporttriple}[3]{\lhoare~ #1 ~\rhoare~ #2 ~\lhoare~ #3 ~\rhoare} %
\newcommand{\landtvlbasic}{\mathrel{\wedge}}%
\newcommand{\landtvllite}{{\color{red}\landtvlbasic}}%
\newcommand{\landtvl}{\mathrel{\color{red}\wedge_{T}}}%
\newcommand{\largevee}{\hbox{\large$\bigvee$}}%
\newcommand{\largewedge}{\hbox{\large$\bigwedge$}}%
\newcommand{\latomic}{{\color{red}\langle}}%
\newcommand{\lcomp}{\mathop{\,\fatsemi\,}}%
\newcommand{\lcreate}{\mathit{create}}%
\newcommand{\lequiv}{\approx}%
\newcommand{\lget}{\textit{\textsf{get}}}%
\newcommand{\lhoare}{\hbox{\large${\color{black}\{}$}}%
\newcommand{\lindep}{\mathop{\,\bowtie\,}}%
\newcommand{\littleckey}[1]{\ckey{\smaller\smaller\smaller#1}}%
\newcommand{\lnottvlbasic}{{\neg_{T}\;}}%
\newcommand{\lnottvlkern}{{\color{red}\neg\!}}%
\newcommand{\lnottvllite}{{\color{red}\lnottvlbasic}}%
\newcommand{\lnottvl}{{\color{red}\neg_{T}\;}}%
\newcommand{\logand}[1]{\mathbin{\theoryelement{\wedge}{#1}}}%
\newcommand{\logeq}[1]{\theoryelement{=}{#1}}%
\newcommand{\logexpr}[2]{\theoryelement{#1}{#2}}%
\newcommand{\logforall}[1]{\mathop{\theoryelement{\forall}{#1}}}%
\newcommand{\logfuns}[1]{\theoryelement{{\cal F}}{#1}}%
\newcommand{\logfun}[2]{\theoryelement{#1}{#2}}%
\newcommand{\logiota}[1]{\mathop{\theoryelement{\iota}{#1}}}%
\newcommand{\lognot}[1]{\mathop{\theoryelement{\neg}{#1}}}%
\newcommand{\logor}[1]{\mathbin{\theoryelement{\vee}{#1}}}%
\newcommand{\logpred}[1]{\theoryelement{{\cal P}}{#1}}%
\newcommand{\logtrue}[1]{\theoryelement{true}{#1}}%
\newcommand{\logvars}[1]{\theoryelement{{\cal V}}{#1}}%
\newcommand{\lone}{\mathbf{1}}%
\newcommand{\lortvlbasic}{\mathrel{\vee}}%
\newcommand{\lortvllite}{{\color{red}\lortvlbasic_{T}}}%
\newcommand{\lortvl}{\mathrel{\color{red}\vee_{T}}}%
\newcommand{\lpart}{\mathrel{|}}%
\newcommand{\lplus}{\oplus}%
\newcommand{\lprod}{\mathop{\bm{\times}}}%
\newcommand{\lput}{\textit{\textsf{put}}}%
\newcommand{\lquot}{\mathop{/\!_\lsbs}}%
\newcommand{\lsbs}{{L}}%
\newcommand{\lsubseteq}{\preceq}%
\newcommand{\lsupseteq}{\mathop{\supseteq_\lsbs}}%
\newcommand{\lto}{\Longrightarrow}
\newcommand{\lzero}{\mathbf{0}}
\newcommand{\lfst}{\textit{\textsf{\textbf{fst}}}}
\newcommand{\lsnd}{\textit{\textsf{\textbf{snd}}}}
\newcommand{\map}{\mathrm{map}}%
\newcommand{\Miracle}{\ckey{Miracle}}%
\mathchardef\mhyphen="2D
\newcommand{\monotonic}[1]{\ckey{monotonic}(#1)}%
\newcommand{\multtvl}{\mathrel{\color{red}*}}%
\newcommand{\myConjunction}{\mathop{\hbox{\Large$\sqcup$}}}%
\newcommand{\myIntchoice}{\mathop{\hbox{\Large$\sqcap$}}}%
\newcommand{\myenddec}{\mathop{\ckey{end}}}%
\newcommand{\myendsy}{]\kern-4pt|}%
\newcommand{\myextrachoice}{\mathrel{\Box\mkern-14mu\raisebox{.25ex}{$+$}}}%
\newcommand{\mylet}{\mathop{\ckey{let}}}%
\newcommand{\myloc}{\mathrel{\ckey{loc}}}%
\newcommand{\myreason}[1]{\textsf{\textit{[#1]}}}%
\newcommand{\mywpD}{\mathop{\ckey{wp}_{\hbox{\tiny\ckey{D}}}}}%
\newcommand{\mywp}{\mathop{\ckey{wp}}}%
\newcommand{\nextcase}{\inccase\printcase}%
\newcommand{\nformula}[2]{#2 \hfill #1}%
\newcommand{\now}{\vcon{t}}%
\newcommand{\ode}[1]{\left\langle \, #1 \, \right\rangle}%
\newcommand{\orseq}{\mathbb{R}_\mathsf{oseq}}%
\newcommand{\parallelm}{\overline{\parallel}}%
\newcommand{\periR}[1]{peri_{\hbox{\tiny\ckey{R}}}(#1)}%
\newcommand{\postD}[1]{post_{\hbox{\tiny\ckey{D}}}(#1)}%
\newcommand{\postR}[1]{post_{\hbox{\tiny\ckey{R}}}(#1)}%
\newcommand{\preempt}[3]{#1 \left[ \, #2 \, \right] #3}%
\newcommand{\preD}[1]{pre_{\hbox{\tiny\ckey{D}}}(#1)}%
\newcommand{\preR}[1]{pre_{\hbox{\tiny\ckey{R}}}(#1)}%
\newcommand{\printcase}{\thecase}%
\newcommand{\psep}[2]{\lceil #1 \rceil_#2}%
\newcommand{\rone}{\healthy{R1}}%
\newcommand{\rtwoc}{\healthy{R2}_c}%
\newcommand{\rthreeh}{\healthy{R3}_h}%
\newcommand{\Rs}{\healthy{R}_s}%
\newcommand{\ratomic}{{\color{red}\rangle}}%
\newcommand{\rdes}{\text{rd}}%
\newcommand{\rtdes}[3]{\healthy{R}_s(#1 \shows #2 \wcond #3)}%
\newcommand{\rc}[3]{\left[~#1 ~~\middle|\hspace{-.4ex}\hbox{-}~~ #2 ~~\middle|~~ #3~\right]}%
\newcommand{\rcpar}[1]{\mathop{~{\parallel}^{\theory{\tiny R}}_{\text{\tiny #1}}~}}%
\newcommand{\rcmergee}[1]{\mathop{~{\parallel}^{\theory{\tiny E}}_{\text{\tiny #1}}~}}%
\newcommand{\rea}{\text{rea}}%
\newcommand{\real}{\mathbb{R}}%
\newcommand{\relcomp}{\mathrel{{[}\mkern-7mu{]}}}%
\newcommand{\reliantaction}[2]{#1 {\color{black}(} #2 {\color{black})}} %
\newcommand{\reliantimage}[2]{#1 {\color{black}\limg} #2 {\color{black}\rimg}} %
\newcommand{\reliantprocess}[2]{#1 {\color{black}\lbag} #2 {\color{black}\rbag}} %
\newcommand{\relsemi}{\mathrel{\hbox{\rm;}}}%
\newcommand{\rewritesto}{\mathrel{~~\leadsto~~}}%
\newcommand{\rhoare}{\hbox{\large${\color{black}\}}$}}%
\newcommand{\rpart}{\mathrel{|}}%
\newcommand{\seqprefix}{\mathrel{\leq}}%
\newcommand{\since}[1]{\{~ \hbox{\textsf{#1}} ~\}}%
\newcommand{\Skip}{\ckey{Skip}}
\newcommand{\smallstrut}{\rule[-2ex]{0pt}{2ex}}%
\newcommand{\solves}[4]{#1 \,\mathrm{solves}\, #2  \,\mathrm{at}\, #3 < #4}
\newcommand{\srdes}{{\tiny\ckey{R}}}%
\newcommand{\strictseqprefix}{\mathrel{\lt}}%
\newcommand{\strict}[1]{\ckey{strict}(#1)}%
\newcommand{\Stop}{\ckey{Stop}}
\newcommand{\subtypex}{\mathrel{\prec}}%
\newcommand{\subtypeeq}{\mathrel{\preceq}}%
\newcommand{\theoryelement}[2]{#1_{\smaller[6]\textsf{\textsl{#2}}}}%
\newcommand{\theory}[1]{\textit{\textbf{#1}}}%
\newcommand{\theoryset}[1]{\llbracket \healthy{#1} \rrbracket}%
\newcommand{\thlfp}[1]{\mu\!\!_{\theory{\tiny #1}}}
\newcommand{\thgfp}[1]{\nu\!\!_{\theory{\tiny #1}}}
\newcommand{\thtop}[1]{\top\!_{\theory{\tiny #1}}}
\newcommand{\thbot}[1]{\bot\!_{\theory{\tiny #1}}}
\newcommand{\thsup}[1]{\bigsqcup{}_{\!\theory{\tiny #1}}~}
\newcommand{\thinf}[1]{\bigsqcap{}_{\!\theory{\tiny #1}}~}
\newcommand{\thinhoaretripleD}[3]{#1 ~\lhoare #2 \rhoare_{\hbox{\tiny\ckey{D}}}~ #3}%
\newcommand{\thinhoaretriple}[3]{#1 ~\lhoare #2 \rhoare~ #3}%
\newcommand{\topD}{\top_{\hbox{\tiny\ckey{D}}}}%
\newcommand{\true}{\ckey{true}}
\newcommand{\false}{\ckey{false}}
\newcommand{\takeWhile}{\mathrm{takeWhile}}
\newcommand{\truetvlbasic}{true}%
\newcommand{\truetvllite}{{\color{red}\truetvlbasic_{T}}}%
\newcommand{\undefinedsym}{\bot}%
\newcommand{\utime}{\emph{ti}}%
\newcommand{\urgent}{\mathrel{\mathsf{urgent}}}%
\newcommand{\scopevar}{\mathop{\ckey{var}}}%
\newcommand{\varrestrict}{\mathop{|}}%
\newcommand{\vcon}[1]{\underline{#1}}%
\newcommand{\vconditional}[3]{\begin{array}{@{}l@{}} #1 \\ \t1 \begin{array}[t]{@{}l@{}} \infixIf #2 \infixElse \\ \t1 #3 \end{array} \end{array}}%
\newcommand{\vdesign}[2]{\begin{array}{l}#1 \\ \shows \\ #2\end{array}}%
\newcommand{\vhoaretriple}[3]{\begin{block} #1 \\ ~\lhoare~ #2 ~\rhoare~ \\ #3 \end{block}} %
\newcommand{\vlamporttriple}[3]{\begin{block} \lhoare~ #1 ~\rhoare~ \\ #2 \\ \lhoare~ #3 ~\rhoare \end{block}}%
\newcommand{\wcond}{\mathop{\,\,\diamond\,\,}}
\newcommand{\while}[2]{\ckey{while}~#1~\ckey{do}~#2}%
\newcommand{\winp}{\mathrel{\mathbf{winp}}}%
\newcommand{\win}{\mathrel{\mathbf{win}}}%
\newcommand{\wpR}{\mathop{\ckey{wp}_\theory{\tiny R}}}%
\newcommand{\wppR}[1]{\mathop{~\ckey{wr}_{\text{\tiny M}~}}}%
\newcommand{\xor}{\mathrel{\oplus}}%

\lstdefinelanguage{CML}{%
  keywords={%
    @,%
    actions,%
    and,%
    att,%
    begin,%
    bool,%
    bot,%
    cases,%
    channels,%
    class,%
    do,%
    dom,%
    dunion,%
    else,%
    elseif,%
    end,%
    extends,%
    for,%
    forall,%
    functions,%
    if,%
    in,%
    int,%
    inter,%
    inv,%
    is,%
    lambda,%
    let,%
    loc,%
    map,%
    meth,%
    mk,%
    mu,%
    nat,%
    not,%
    null,%
    of,%
    operations,%
    or,%
    others,%
    power,%
    post,%
    pre,%
    process,%
    public,%
    res,%
    ret,%
    rng,%
    self,%
    seq,%
    set,%
    startby,%
    state,%
    subset,%
    super,%
    then,%
    to,%
    token,%
    types,%
    union,%
    values,%
    val, %
    var, %
    vres, %
    wait,%
    while%
 }%
}%

\lstset{%
  keywordstyle=\bfseries,%
  language=CML,%
  basicstyle=\ttfamily,%
  showstringspaces=false%
}%

\newcommand{\transit}[3]{%
  #1 \xrightarrow{#2} #3%
}%

\newcommand{\transitv}[3]{%
  \begin{array}[t]{@{}l}%
    #1 \\ %
    \quad \mathrel{{}\xrightarrow{#2}{}} \\ %
    \qquad #3%
  \end{array}%
}%

\newcommand{\transitvv}[3]{%
  \begin{array}[t]{@{}l}%
    #1 \\ %
    \mathrel{{} \xrightarrow{#2}{}} \\ %
    #3%
  \end{array}%
}%

% typeset optional arguments to \parallel as pre and post subscripts%
\makeatletter %
\def\@@parallel[#1][#2]{%
  \mathrel{%
    {\vphantom\parallel@sym}_{#1}{\parallel@sym}_{#2}}} %
\makeatother %

\makeatletter%
\def\myargue{%
  \@zed\interzedlinepenalty=\interdisplaylinepenalty%
  \openup\@jot \halign to\linewidth\bgroup%
  \strut%
  $\color{ZedColor}\@zlign##$\hfil \tabskip=0pt plus1fil%
  &\hbox to0pt{%
    \color{AnnotationColor}\hss\@zlign##\unskip}\tabskip=0pt\cr%
  \noalign{\vskip-\@jot}}%
\let\endmyargue=\endzed%
\makeatother%

% typeset optional arguments to \parallel as pre and post subscripts%
\makeatletter %
\def\@@parallel[#1][#2]{%
  \mathrel{%
    {\vphantom\parallel@sym}_{#1}{\parallel@sym}_{#2}}} %
\makeatother %

\newcommand{\prog}[2]{( \mathtt{#1}, \mathtt{#2} )}
\newcommand{\sem}[2]{( #1 \relsemi #2 )}

% \newcommand{\lchanset}{{\{}\mkern-5mu{|}~}
% \newcommand{\rchanset}{~{|}\mkern-5mu{\}}}

\newcommand{\adjust}{~~~~~~~~}

\newcommand{\csptrans}[2]{\mathtt{#1} \longrightarrow \mathtt{#2}}
\newcommand{\cspaction}[3]{%
  \mathtt{#1} \xrightarrow{\mathtt{#2}}\mathtt{#3}%
}%

\newcommand{\cspactionref}[3]{%
  #1 ~~\refinedby~~ ( #2 \then #3 ) \extchoice #1
}%

\newcommand{\circustrans}[3]{%
  \mathtt{#1 \xrightarrow{#2} #3}%
}%

\newcommand{\config}[3]{%
  \left( \mathtt{#1} | \mathtt{#2} \models \mathtt{#3} \right)%
}%

\newcommand{\sosrule}[2]{%
  \frac{~~ \displaystyle \mathtt{#1} ~~ }{~~ \displaystyle \mathtt{#2} ~~}
}%

\newcommand{\circustransbreak}[3]{%
  \begin{array}[t]{@{}l}
    \mathtt{#1} \\ %
    \qquad 
    \begin{array}[t]{@{}l}
      \stackrel{#2}{\longrightarrow} \\ %
      \qquad \mathtt{#3}%
    \end{array}
  \end{array}
}%

\newcommand{\sledgehammer}{\emph{sledgehammer}}
\newcommand{\ubind}{\mathfrak{B}}
\newcommand{\ubindarb}{\mathcal{B}}
\newcommand{\uvar}{\mathbb{V}}
\newcommand{\uval}{\mathbb{U}}
\newcommand{\utype}{\mathcal{T}}
\newcommand{\utyperel}{\mathop{\textbf{:}}}
\newcommand{\ubovrd}[3]{#1 \oplus_b #2 \mathop{on} #3}
\newcommand{\ubeq}[3]{#1 \cong #2 \mathop{on} #3}
\newcommand{\usovrd}[2]{#1 \oplus_s #2}
\newcommand{\ucoerce}[2]{\textrm{coerce}_{#1}(#2)}

\newcommand{\unrest}[2]{#1 \, \mathop{\sharp} \, #2}
\newcommand{\substapp}[2]{#1 \mathop{\dagger} #2}
\newcommand{\permapp}[2]{#1 \mathop{\spot} #2}

\newcommand{\upred}{\mathit{upred}}
\newcommand{\urel}{\mathit{rel}}
\newcommand{\uexpr}{\textrm{\emph{Expr}}}
\newcommand{\usubst}{\textrm{\emph{Subst}}}

\newcommand{\elit}[1]{\lfloor #1 \rfloor}
\newcommand{\ugasn}[2]{\langle #1 \rangle_{#2}}

\newcommand{\invar}{\textrm{in}}
\newcommand{\outvar}{\textrm{out}}

\newcommand{\new}{\textbf{new}}
\newcommand{\mvar}[1]{\mathbf{#1}}

% Semantic functions

\newcommand{\tysem}[1]{\llbracket #1 \rrbracket_\textbf{ty}}
\newcommand{\expsem}[1]{\llbracket #1 \rrbracket_\textbf{exp}}
\newcommand{\progsem}[1]{\llbracket #1 \rrbracket_\textbf{prg}}
\newcommand{\tydsem}[1]{\llbracket #1 \rrbracket_\textbf{tyd}}
\newcommand{\fundsem}[1]{\llbracket #1 \rrbracket_\textbf{fnd}}
\newcommand{\valdsem}[1]{\llbracket #1 \rrbracket_\textbf{vld}}
\newcommand{\ivdsem}[1]{\llbracket #1 \rrbracket_\textbf{ivd}}
\newcommand{\opdsem}[1]{\llbracket #1 \rrbracket_\textbf{opd}}

\newcommand{\asnsem}[1]{\llbracket #1 \rrbracket_\textbf{asn}}
\newcommand{\sasnsem}[1]{\llbracket #1 \rrbracket_\textbf{sasn}}

% OO constants

\newcommand{\cname}{\emph{CName}}
\newcommand{\aname}{\emph{AName}}
\newcommand{\oname}{\emph{OName}}
\newcommand{\mname}{\emph{MName}}
\newcommand{\btype}{\mathcal{T}}
\newcommand{\type}{\emph{Type}}
\newcommand{\pred}{\emph{Pred}}
\newcommand{\meth}[2]{\textbf{meth}\,#1~~#2}
\newcommand{\att}[2]{\textbf{att}\,#1~~#2}
\newcommand{\invariant}[2]{\textbf{invar}\,#1~~#2}
\newcommand{\static}[1]{\emph{#1-stat}}
\newcommand{\Object}{\ckey{Object}}

% Trace operators

\newcommand{\tset}{\mathcal{T}}
\newcommand{\tcat}{\cat}
\newcommand{\tminus}{-}
\newcommand{\tempty}{\langle\rangle}
\newcommand{\trace}{\ckey{tt}}
\newcommand{\ttend}{\textnormal{end}}
\newcommand{\ttrace}{\mathbf{tt}}
\newcommand{\ttrtype}{\mathbb{T}\!\mathbb{T}}
\newcommand{\rshift}{\bm{\gg}}

% \newcommand{\extrachoice}{\mathrel{\hbox{\LARGE$\diamond$}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%